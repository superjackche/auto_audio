# 课堂语义行为实时分析系统使用指南 (v0.2.0)

## 1. 系统安装

### 1.1 安装依赖

首先确保您已安装Python 3.11或更高版本，然后执行以下命令安装所需依赖：

```bash
# 克隆代码库（如果是通过Git获取）
git clone https://github.com/superjackche/auto_audio.git
cd auto_audio

# 使用自动化安装脚本（推荐）
python install_dependencies.py

# 或者手动安装
pip install -r requirements.txt

# 或者使用开发模式安装
pip install -e .
```

> **注意**: 在Windows上，某些依赖（如PyAudio）可能需要额外的步骤。如果`install_dependencies.py`脚本无法安装PyAudio，您可以从[非官方Python库](https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio)下载适用于Python 3.11的wheel文件并手动安装。

### 1.2 初始化环境

系统首次运行需要初始化环境：

```bash
# 在Windows PowerShell中
.\scripts\setup_dev.ps1

# 或手动创建目录
mkdir -p data/logs data/models data/reports data/test_audio
```

## 2. 系统配置

系统的主要配置文件位于 `config` 目录下：

- `config.yaml`: 系统全局配置
- `auth.yaml`: 用户认证配置
- `keywords.txt`: 敏感关键词列表

### 2.1 管理员账户

默认的管理员账户为：
- 用户名：admin
- 密码：admin123

### 2.2 语音识别配置

系统支持两种Whisper语音识别实现:

1. **OpenAI Whisper** - 原始实现
2. **Faster Whisper** - 优化实现（推荐）

运行以下命令选择安装:

```bash
python install_whisper.py
```

或者使用工具测试Whisper安装:

```bash
python tools/test_whisper.py
```

## 3. 启动系统

系统提供多种启动方式，根据您的操作系统和需求选择相应方法：

### 3.1 Windows 一键启动

Windows 用户可以直接双击运行以下文件之一：

- `start.bat` - 标准批处理脚本启动
- `start.ps1` - PowerShell 脚本启动（右键选择"使用 PowerShell 运行"）

### 3.2 命令行启动

```bash
python run.py
```

可以通过参数定制启动方式：

```bash
# 指定主机和端口
python run.py --host 0.0.0.0 --port 8080

# 启用调试模式
python run.py --debug
```

## 4. 使用系统

### 4.1 访问Web界面

启动系统后，打开浏览器访问：

```
http://localhost:5000
```

使用管理员账户登录系统。

### 4.2 主要功能

系统包含以下主要功能模块：

1. **仪表盘**：显示系统整体状态和统计信息
2. **实时监控**：对课堂语音进行实时监控和分析
3. **风险报告**：查看历史分析结果和风险评估报告
4. **系统设置**：配置系统参数和预警阈值

### 4.3 实时监控 (v0.2.0新功能)

在"实时监控"页面，您现在可以选择两种监控方式：

#### 4.3.1 麦克风实时监控

1. 在"实时麦克风监控"选项卡下，点击麦克风按钮开始监控
2. 系统将实时捕获麦克风输入，并进行语音识别和风险分析
3. 再次点击麦克风按钮停止监控
4. 分析结果会实时显示在页面上，并根据风险等级进行视觉标记

### 4.3.2 音频文件分析 (新功能)

1. 切换到"音频文件分析"选项卡
2. 通过点击或拖放方式上传MP3、WAV或OGG音频文件（最大50MB）
3. 点击"开始分析"按钮开始处理
4. 系统会对整个音频文件进行转录和分析，并提供完整的风险评估结果
5. 分析结果将显示在左侧转录区域，同时右侧会显示风险等级和具体风险因素
6. 分析完成的数据会自动保存到系统历史记录中，可在"风险报告"页面查看

音频分析完成后，您可以：

- 导出分析文字内容为CSV文件
- 清空当前分析结果
- 上传新的音频文件进行分析

> **提示**：音频文件分析功能特别适合对课程录音或预先准备的音频内容进行离线分析，可用于教学质量评估和风险预警。

#### 4.3.3 功能对比

| 功能 | 麦克风实时监控 | 音频文件分析 |
|------|---------------|------------|
| 输入来源 | 设备麦克风 | 本地音频文件 |
| 处理方式 | 实时流处理 | 批处理 |
| 适用场景 | 现场监控 | 课程回放分析 |
| 支持格式 | - | MP3/WAV/OGG |
| 时效性 | 实时 | 延迟处理 |

### 4.4 风险报告

在"风险报告"页面，您可以：

1. 浏览历史风险记录
2. 按时间、风险级别等条件过滤报告
3. 查看详细的风险分析和证据
4. 导出报告数据

## 5. 测试系统

### 5.1 下载测试音频

系统提供了工具下载一些测试用的中文语音样本：

```bash
python tools/download_test_audio.py
```

下载的测试音频将保存在 `data/test_audio` 目录中。

### 5.2 测试语音识别

您可以使用已下载的测试音频来验证系统的语音识别功能：

1. 登录系统
2. 进入"实时监控"页面
3. 切换到"音频文件分析"选项卡
4. 上传测试音频文件并分析

### 5.3 测试音频文件分析工具

也可以使用命令行工具直接分析音频文件:

```powershell
python tools/analyze_audio_file.py "data/test_audio/sample1.mp3"
```

## 6. 系统维护

### 6.1 日志文件

系统日志保存在 `data/logs` 目录下，可用于排查问题。

### 6.2 数据备份

定期备份 `data` 目录，特别是 `data/reports` 目录中的分析报告数据。

## 7. 故障排除

如果遇到问题，请尝试以下步骤：

1. 检查日志文件中的错误信息
2. 确认所有依赖包都已正确安装
3. 重启系统
4. 清空浏览器缓存

如果问题仍然存在，请联系系统管理员或提交Issue到Github仓库。
